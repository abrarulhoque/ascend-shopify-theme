{{ 'section-product-quiz.css' | asset_url | stylesheet_tag }}
<script src="{{ 'product-quiz.js' | asset_url }}" defer="defer"></script>

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  .section-{{ section.id }}-margin {
    margin-top: {{ section.settings.margin_top | times: 0.75 | round: 0 }}px;
    margin-bottom: {{ section.settings.margin_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
    .section-{{ section.id }}-margin {
      margin-top: {{ section.settings.margin_top }}px;
      margin-bottom: {{ section.settings.margin_bottom }}px;
    }
  }
{%- endstyle -%}

<div class="section-product-quiz page-width section-{{ section.id }}-margin">
  <div class="section__wrapper product-quiz__wrapper isolate lg-round color-{{ section.settings.color_scheme }} gradient section-{{ section.id }}-padding">
    {%- if section.settings.texture_image != blank -%}
      <div
        class="texture-background-image media{% if section.settings.texture_fixed %} background--fixed{% endif %}"
        style="opacity: {{ section.settings.texture_alpha }}%;"
      >
        {% render 'lazy-image', image_object: section.settings.texture_image %}
      </div>
    {%- endif -%}
    
    <div id="product-quiz" class="product-quiz" data-section-id="{{ section.id }}" data-product-collection="{{ section.settings.product_collection }}">
      <!-- Quiz intro -->
      <div class="quiz-intro{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}">
        {% if section.settings.show_profile_image and section.settings.profile_image != blank %}
          <div class="profile-image">
            <img
              srcset="{%- if section.settings.profile_image.width >= 165 -%}{{ section.settings.profile_image | image_url: width: 165 }} 165w,{%- endif -%}
                {%- if section.settings.profile_image.width >= 360 -%}{{ section.settings.profile_image | image_url: width: 360 }} 360w,{%- endif -%}
                {{ section.settings.profile_image | image_url }} {{ section.settings.profile_image.width }}w"
              src="{{ section.settings.profile_image | image_url: width: 360 }}"
              sizes="(min-width: 990px) 165px, (min-width: 750px) 135px, 110px"
              alt="{{ section.settings.profile_image.alt | escape }}"
              width="{{ section.settings.profile_image.width }}"
              height="{{ section.settings.profile_image.height }}"
              loading="lazy"
              class="quiz-profile-image"
            >
          </div>
        {% endif %}
        
        {% if section.settings.intro_subheading != blank %}
          <div class="quiz-intro-subheading">{{ section.settings.intro_subheading }}</div>
        {% endif %}
        
        {% if section.settings.intro_heading != blank %}
          <h2 class="quiz-intro-heading">{{ section.settings.intro_heading }}</h2>
        {% endif %}
        
        {% if section.settings.intro_text != blank %}
          <div class="quiz-intro-text">{{ section.settings.intro_text }}</div>
        {% endif %}
      </div>
      
      <!-- Quiz questions container -->
      <div class="quiz-questions-container">
        {% for block in section.blocks %}
          {% case block.type %}
            {% when 'question' %}
              <div class="quiz-question" id="question-{{ forloop.index }}" {{ block.shopify_attributes }} data-question-index="{{ forloop.index }}" style="display: {% if forloop.index == 1 %}flex{% else %}none{% endif %};">
                <div class="quiz-question-header">
                  <h3 class="quiz-question-title">{{ block.settings.question_title }}</h3>
                  {% if section.settings.show_question_count %}
                    <div class="quiz-question-count">
                      <span class="current">{{ forloop.index }}</span> of <span class="total">{{ section.blocks.size }}</span>
                    </div>
                  {% endif %}
                  {% if section.settings.show_progress_bar %}
                    <div class="quiz-progress-bar">
                      <div class="quiz-progress-bar-inner" style="width: {{ forloop.index | times: 100 | divided_by: section.blocks.size }}%"></div>
                    </div>
                  {% endif %}
                </div>
                
                <div class="quiz-options">
                  {% if block.settings.option_a != blank %}
                    <div class="quiz-option" data-option="A" data-value="{{ block.settings.option_a_value }}">
                      <div class="quiz-option-letter">A</div>
                      <div class="quiz-option-content">
                        {{ block.settings.option_a }}
                      </div>
                    </div>
                  {% endif %}
                  
                  {% if block.settings.option_b != blank %}
                    <div class="quiz-option" data-option="B" data-value="{{ block.settings.option_b_value }}">
                      <div class="quiz-option-letter">B</div>
                      <div class="quiz-option-content">
                        {{ block.settings.option_b }}
                      </div>
                    </div>
                  {% endif %}
                  
                  {% if block.settings.option_c != blank %}
                    <div class="quiz-option" data-option="C" data-value="{{ block.settings.option_c_value }}">
                      <div class="quiz-option-letter">C</div>
                      <div class="quiz-option-content">
                        {{ block.settings.option_c }}
                      </div>
                    </div>
                  {% endif %}
                </div>
                
                <div class="quiz-navigation">
                  {% if forloop.index > 1 %}
                    <button type="button" class="button button--secondary prev-question">{{ section.settings.prev_button_text }}</button>
                  {% endif %}
                  
                  {% if forloop.index == section.blocks.size %}
                    <button type="button" class="button see-results-button" disabled>{{ section.settings.results_button_text }}</button>
                  {% else %}
                    <button type="button" class="button next-question" disabled>{{ section.settings.next_button_text }}</button>
                  {% endif %}
                </div>
              </div>
          {% endcase %}
        {% endfor %}
      </div>
      
      <!-- Quiz results -->
      <div class="quiz-results" style="display: none;">
        <div class="quiz-results-header">
          {% if section.settings.results_profile_image != blank %}
            <div class="profile-image">
              <img
                srcset="{%- if section.settings.results_profile_image.width >= 165 -%}{{ section.settings.results_profile_image | image_url: width: 165 }} 165w,{%- endif -%}
                  {%- if section.settings.results_profile_image.width >= 360 -%}{{ section.settings.results_profile_image | image_url: width: 360 }} 360w,{%- endif -%}
                  {{ section.settings.results_profile_image | image_url }} {{ section.settings.results_profile_image.width }}w"
                src="{{ section.settings.results_profile_image | image_url: width: 360 }}"
                sizes="(min-width: 990px) 165px, (min-width: 750px) 135px, 110px"
                alt="{{ section.settings.results_profile_image.alt | escape }}"
                width="{{ section.settings.results_profile_image.width }}"
                height="{{ section.settings.results_profile_image.height }}"
                loading="lazy"
                class="quiz-profile-image"
              >
            </div>
          {% endif %}
          
          {% if section.settings.results_heading != blank %}
            <h2 class="quiz-results-heading">{{ section.settings.results_heading }}</h2>
          {% endif %}
          
          {% if section.settings.results_text != blank %}
            <div class="quiz-results-text">{{ section.settings.results_text }}</div>
          {% endif %}
          
          {% if section.settings.show_review_link and section.settings.review_link != blank %}
            <div class="quiz-review-link">
              <a href="{{ section.settings.review_link }}">{{ section.settings.review_link_text }}</a>
            </div>
          {% endif %}
        </div>
        
        <div class="quiz-recommended-products">
          <div class="loading-spinner" style="display: none;">
            <div class="spinner"></div>
            <p>{{ section.settings.loading_text }}</p>
          </div>
          
          <div class="recommended-products-grid">
            <!-- Products will be loaded here via JavaScript -->
          </div>
        </div>
        
        {% if section.settings.show_restart_button %}
          <div class="quiz-restart">
            <button type="button" class="button button--secondary restart-quiz-button">{{ section.settings.restart_button_text }}</button>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<template id="product-recommendation-template">
  <div class="product-recommendation">
    <div class="product-recommendation-image">
      <img src="" alt="" class="product-image">
    </div>
    <div class="product-recommendation-info">
      <h3 class="product-recommendation-title"></h3>
      <div class="product-recommendation-rating"></div>
      <div class="product-recommendation-price"></div>
      <div class="product-recommendation-reason"></div>
      <div class="product-recommendation-actions">
        <a href="#" class="product-recommendation-link button">{{ section.settings.product_button_text }}</a>
      </div>
    </div>
  </div>
</template>

{% schema %}
{
  "name": "Product Quiz",
  "tag": "section",
  "class": "section",
  "disabled_on": {
    "groups": ["header", "footer", "custom.drawer", "custom.popup"]
  },
  "settings": [
    {
      "type": "header",
      "content": "Quiz Appearance"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "background-1"
    },
    {
      "type": "image_picker",
      "id": "texture_image",
      "label": "Background image"
    },
    {
      "type": "range",
      "id": "texture_alpha",
      "label": "Image opacity",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "%",
      "default": 10
    },
    {
      "type": "checkbox",
      "id": "texture_fixed",
      "label": "Fix background image in place",
      "default": false
    },
    {
      "type": "header",
      "content": "Introduction"
    },
    {
      "type": "checkbox",
      "id": "show_profile_image",
      "label": "Show profile image",
      "default": true
    },
    {
      "type": "image_picker",
      "id": "profile_image",
      "label": "Profile image"
    },
    {
      "type": "text",
      "id": "intro_subheading",
      "label": "Introduction subheading",
      "default": "Our co-founder Brandon will help you"
    },
    {
      "type": "text",
      "id": "intro_heading",
      "label": "Introduction heading",
      "default": "Find the Perfect Pickleball Paddle"
    },
    {
      "type": "richtext",
      "id": "intro_text",
      "label": "Introduction text",
      "default": "<p>I've tested over 80 paddles but only include the best in my recommendations. This quiz helps me learn your needs and play style. After the quiz, I'll recommend the 3 best paddles that fit your game.</p>"
    },
    {
      "type": "header",
      "content": "Question Display"
    },
    {
      "type": "checkbox",
      "id": "show_question_count",
      "label": "Show question count",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_progress_bar",
      "label": "Show progress bar",
      "default": true
    },
    {
      "type": "text",
      "id": "next_button_text",
      "label": "Next button text",
      "default": "Next"
    },
    {
      "type": "text",
      "id": "prev_button_text",
      "label": "Previous button text",
      "default": "Prev"
    },
    {
      "type": "text",
      "id": "results_button_text",
      "label": "Results button text",
      "default": "See your paddles"
    },
    {
      "type": "header",
      "content": "Results"
    },
    {
      "type": "image_picker",
      "id": "results_profile_image",
      "label": "Results profile image"
    },
    {
      "type": "text",
      "id": "results_heading",
      "label": "Results heading",
      "default": "These Paddles are Perfect for You"
    },
    {
      "type": "richtext",
      "id": "results_text",
      "label": "Results text",
      "default": "<p>Here are 3 paddles that match the preferences you expressed in the quiz. I'm confident any of these options will help advance your game.</p>"
    },
    {
      "type": "checkbox",
      "id": "show_review_link",
      "label": "Show review process link",
      "default": true
    },
    {
      "type": "text",
      "id": "review_link_text",
      "label": "Review link text",
      "default": "my review process"
    },
    {
      "type": "url",
      "id": "review_link",
      "label": "Review process page"
    },
    {
      "type": "text",
      "id": "loading_text",
      "label": "Loading text",
      "default": "Finding your perfect paddles..."
    },
    {
      "type": "text",
      "id": "product_button_text",
      "label": "Product button text",
      "default": "Get 10% Off"
    },
    {
      "type": "checkbox",
      "id": "show_restart_button",
      "label": "Show restart button",
      "default": true
    },
    {
      "type": "text",
      "id": "restart_button_text",
      "label": "Restart button text",
      "default": "Take the quiz again"
    },
    {
      "type": "collection",
      "id": "product_collection",
      "label": "Product collection",
      "info": "Collection of products to recommend from"
    },
    {
      "type": "header",
      "content": "Section Spacing"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding top",
      "default": 48
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding bottom",
      "default": 48
    },
    {
      "type": "range",
      "id": "margin_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Margin top",
      "default": 0
    },
    {
      "type": "range",
      "id": "margin_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Margin bottom",
      "default": 0
    }
  ],
  "blocks": [
    {
      "type": "question",
      "name": "Quiz Question",
      "limit": 7,
      "settings": [
        {
          "type": "text",
          "id": "question_title",
          "label": "Question",
          "default": "What's most important to you?"
        },
        {
          "type": "header",
          "content": "Option A"
        },
        {
          "type": "text",
          "id": "option_a",
          "label": "Option text",
          "default": "Power"
        },
        {
          "type": "text",
          "id": "option_a_value",
          "label": "Option value",
          "default": "power",
          "info": "Used for filtering products"
        },
        {
          "type": "header",
          "content": "Option B"
        },
        {
          "type": "text",
          "id": "option_b",
          "label": "Option text",
          "default": "Control"
        },
        {
          "type": "text",
          "id": "option_b_value",
          "label": "Option value",
          "default": "control",
          "info": "Used for filtering products"
        },
        {
          "type": "header",
          "content": "Option C"
        },
        {
          "type": "text",
          "id": "option_c",
          "label": "Option text",
          "default": "Both"
        },
        {
          "type": "text",
          "id": "option_c_value",
          "label": "Option value",
          "default": "both",
          "info": "Used for filtering products"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Product Quiz",
      "blocks": [
        {
          "type": "question",
          "settings": {
            "question_title": "What's most important to you?",
            "option_a": "Power",
            "option_a_value": "power",
            "option_b": "Control",
            "option_b_value": "control",
            "option_c": "Both",
            "option_c_value": "both"
          }
        },
        {
          "type": "question",
          "settings": {
            "question_title": "What do you value more?",
            "option_a": "Reach",
            "option_a_value": "reach",
            "option_b": "Large sweet spot",
            "option_b_value": "sweet_spot",
            "option_c": "Both",
            "option_c_value": "both"
          }
        },
        {
          "type": "question",
          "settings": {
            "question_title": "What's your budget?",
            "option_a": "Under $100",
            "option_a_value": "budget",
            "option_b": "$100 to $200",
            "option_b_value": "mid_range",
            "option_c": "No budget",
            "option_c_value": "premium"
          }
        }
      ]
    }
  ]
}
{% endschema %} 